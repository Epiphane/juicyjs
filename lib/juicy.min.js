!function(t,n,i,e,s,o,r,a,h,u,c,f,d,l,m,p,v,_,y,g,w,x,C,k,b,I,M,R,T,E,A,P,S,J,q,D,z,B,F,L,j){"use strict";!function(I,L){var j=function(){return I.requestAnimationFrame||I.webkitRequestAnimationFrame||I.mozRequestAnimationFrame||function(t){I.setTimeout(t,1e3/60)}}(),G=I._J={},H=G.P=function(t,n){this.x=t=t||0,this.y=n||t};H[t].add=function(t){return new H(this.x+t.x,this.y+t.y)},H[t].mult=function(t){return new H(this.x*(t.x||t),this.y*(t.y||t))},H[t].sub=function(t){return this.add(t.mult(-1))},H[t][h]=function(t){return Math.sqrt(this.x*this.x+this.y*this.y)};var O={},W=G.Sound=function(t,n,i){"string"!=typeof n&&(n=t,i=n),this[C]=n,O[t]||W.load(t,n,i)};W.load=function(t,n,i){var e=O[t]=L[c]("audio");i&&(e.loop="loop");var s=L[c]("source");s.src=n,e.appendChild(s),e.load()},W.play=W[t].play=function(t){t=this[C]||t,O[t].play()},W[T]=W[t][T]=function(t){t=this[C]||t,O[t][T]()};var X=G.G={},Y=new H(1),K=new H,N=!1,Q=!1,U=!1,V=!1,Z=!1,$={},tt={},nt={},it={};L.onkeydown=function(t){$[t.keyCode]=!0},L.onkeyup=function(t){$[t.keyCode]=!1;var n="key_"+nt[t.keyCode];Q&&Q[n]&&Q[n](nt[t.keyCode])},X[z]=function(t,i,e,o){N=!1,X[s]=i,X[n]=e,X.setCanvas(t),tt=o||{},nt={};for(var r in o)nt[o[r]]=r;return this},X.keyDown=function(t){if("string"==typeof t)return $[tt[t]];for(var n=0;n<t[h];n++)if(X.keyDown(t[n]))return!0;return!1},X.on=function(t,n,i){if("key"===t){"object"!=typeof n&&(n=[n]);for(var e=0;e<n[h];e++){var s=n[e];Q["key_"+s]=i}}else it[t]&&L[x](t,it[t]),L.addEventListener(t,it[t]=n);return this};var et=function(){for(var t in it)L[x](t,it[t]);it={}};X[a]=function(t){var i=U.getBoundingClientRect(),e=t.clientX-i.left,o=t.clientY-i.top;return new H(Math[D](e*X[s]/U[s]),Math[D](o*X[n]/U[n]))},X.setCanvas=function(t){U=t,V=t[k]("2d");var n=!1;return t.onmousedown=function(t){n=t,X[y]("dragstart",t)},t.onmouseup=function(t){var i=X[a](n),e=X[a](t);i.sub(e)[h]()<=2?X[y]("click",t):X[y]("dragend",t),n=!1},t.onmousemove=function(t){K=X[a](t),n&&X[y]("drag",t)},X.resize(),this},X.resize=function(){var t=U.parentElement,i=t[s]||t.clientWidth,e=t[n]||t.clientHeight;return U[s]=i,U[n]=i*X[n]/X[s],U[n]>e&&(U[n]=e,U[s]=e*X[s]/X[n]),Y=new H(U[s]/X[s],U[n]/X[n]),Q&&(Q.__hasRendered=!1),this},X.setState=function(t){return et(),Q=t,Q.game=X,Q[z](),Q.__hasRendered=!1,this},X[y]=function(t,n){Q&&Q[t]&&Q[t](X[a](n))},X[f]=function(){if(N){j(X[f]);var t=(new Date).getTime(),n=(t-Z)/1e3;if(n>.2)return void(Z=t);try{var i=!Q[f](n,X)||Q[u];Q[u]=!1,Z=t,(i||!Q.__hasRendered)&&(X[d](),Q.__hasRendered=!0)}catch(e){console.error(e),X[T]()}}},X[d]=function(){return V.save(),V[g](Y.x,Y.y),Q.stopClear||V.clearRect(0,0,X[s],X[n]),Q[d](V),V.restore(),this},X.run=function(){return N=!0,Z=(new Date).getTime(),X[f](),this},X[T]=function(){N=!1};var st=G.S=function(){};st[t][z]=st[t][f]=st[t][d]=function(){};var ot=0,rt=G.E=function(t,e){"string"==typeof e&&(e=[e]),this[i]={},this[u]={},this.state=t,this[p]=[],e=e||this.__proto__[i],this[o]=new H,this[g]=new H(1),this[s]=this[n]=0;for(var r=0;r<e[h];r++)this[q](e[r]);this[z]&&this[z]()};rt[t][i]=[],rt[t][q]=function(t,n){if("function"==typeof t)t=new t(this);else if("string"==typeof t){if(!G.Cs[t])throw"Component "+t+" does not exist";t=new G.Cs[t](this)}t.__proto__[C]||(t.__proto__[C]="_component_"+ot.toString(),ot++);var n=n||t.__proto__[C];if(this.components[n])throw"Component "+n+" already exists";t.entity=this,this.components[n]=t},rt[t].getComponent=function(t){return this.components[t]},rt[t][f]=function(t,n){if(n&&!this.updated[n])return this.updated[n]=!0,this.components[n][f](t,this.state.game),this.components[n];this[u]={};for(var e in this[i])this.updated[e]||this[f](t,e)},rt[t][d]=function(e){e.save();var r=this[o];e.translate(r.x,r.y),e[g](this[g].x,this[g].y);var a=Array[t].slice.call(arguments);1===a[h]&&(a[B](0),a[B](0),a[B](this[s]),a[B](this[n]));for(var u in this[i])this.components[u][d][E](this.components[u],a);if(this.children[h]>0)for(var c=0;c<this.children[h];c++)this.children[c][d](e);e.restore()},rt[t].addChild=function(t){t[A]=this,this[p][B](t)},rt[t][P]=function(){var t,n=this[o];return(t=this[A])?t[P]().add(this[o].mult(t[w]())):n},rt[t][w]=function(){var t=this[g];return this[A]?this[g].mult(this.parent[w]()):t};var at=G.C=function(){};at[t][C]=0,at[t][f]=at[t][d]=function(){},G.Cs={},at[S]=function(t,n,i){return n[C]=n[C]||t,G.Cs[t]=this[J](n,i)};var ht=function(t){for(var n=1;n<arguments[h];n++){var i=arguments[n];for(var e in i)t[e]=i[e]}},ut=function(n,i){var e,s=this;e=n[l]!==n.__proto__[l]?n[l]:function(){return s[E](this,arguments)},ht(e,s,i||{});var o=function(){this[l]=e};return o[t]=s[t],e[t]=new o,n&&ht(e[t],n),e[t].__super__=s[t],e};st[J]=rt[J]=at[J]=ut,at[S]("Image",{constructor:function(t){var i=this;this._tint=!1,this[M]=1,this[m]=new Image,this[m][F]=function(){t[s]||t[n]||(t[s]=this[s],t[n]=this[n]),i._tint&&i.setTint(i._tint),i[F]&&i[F](this),t.state[u]=!0},this[m].onerror=function(){i[m]=new Image},t.setImage=this.setImage.bind(this)},setTint:function(t){if(this._tint=t,this[m].complete){var i=this[v]=this[v]||L[c]("canvas");i[s]=this.image[s],i[n]=this.image[n];var o=i[k]("2d");o[e]=this._tint,o.fillRect(0,0,i[s],i[n]),o.globalCompositeOperation="destination-atop",o[r]=.75,o[_](this[m],0,0),o[r]=1}return this},setImage:function(t){return this[m].src=t,this},render:function(t){var n=t[r],i=arguments;t[r]=this[M],i[0]=this[m],t[_][E](t,i),this._tint&&(i[0]=this[v],t[_][E](t,i)),t[r]=n}}),at[S]("Box",{constructor:function(){this[e]="white"},render:function(t,n,i,s,o){t[e]=this[e],t.fillRect(n,i,s,o)}}),at[S]("Text",{constructor:function(){this[v]=L[c]("canvas"),this.context=this[v][k]("2d");var t=this[R]={};t[b]="32px Arial",t[R]="",t[e]="white",this[M]=1},set:function(t){var i=this[R],o=this.entity,r=this.context,a=this[v];i[b]=t[b]||i[b],i[R]=t[R]||i[R],i[e]=t[e]||i[e],r[b]=i[b],r[e]=i[e];var h=r.measureText(i[R]);o[s]=a[s]=Math.ceil(h[s]),o[n]=a[n]=Math.ceil(5*parseInt(i[b])/3),r.textBaseline="top",r[b]=i[b],r[e]=i[e],r.fillText(i[R],0,0)},render:function(t){var n=t[r];t[r]=this[M],arguments[0]=this[v],t[_][E](t,arguments),t[r]=n}})}(window,document),function(i,e){_J.rand=function(t,n){return n?Math[D](Math.random()*(n-t))+t:Math[D](Math.random()*t)},_J.PI=Math.PI,e[t].contains=function(t){return t=t.sub(this[o]),t.x>=0&&t.y>=0&&t.x<=this[s]&&t.y<=this[n]},e[t].distance=function(t){return t.x||(t=t[o]),this[o].sub(t)[h]()},e[t].testCollision=function(t){var i=t[o].add(new Point(t[s],t[n])),e=this[o].add(new Point(this[s],this[n]));return i.x>=this[o].x&&i.y>=this[o].y&&t[o].x<=e.x&&t[o].y<=e.y}}(window._J,_J.E)}("prototype","height","components","fillStyle","width","position","globalAlpha","getCanvasCoords","length","updated","createElement","update","render","constructor","image","children","canvas","drawImage","trigger","scale","globalScale","removeEventListener","name","getContext","font","keyCode","opacity","text","pause","apply","parent","globalPosition","create","extend","addComponent","floor","init","push","onload",function(){},function(){return document.createElement("canvas")});