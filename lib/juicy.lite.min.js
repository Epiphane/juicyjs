!function(t,n,e,i,o,s,r,a,h,u,c,f,d,l,m,p,v,g,_,y,w,C,x,k,R,b,I,T,A,E,S,M,q,D,z,B,F,L,P,j){"use strict";!function(b,P){var j=function(){return b.requestAnimationFrame||b.webkitRequestAnimationFrame||b.mozRequestAnimationFrame||function(t){b.setTimeout(t,1e3/60)}}(),G=b._J={},H=G.P=function(t,n){this.x=t=t||0,this.y=n||t};H[t].add=function(t){return new H(this.x+t.x,this.y+t.y)},H[t].mult=function(t){return new H(this.x*(t.x||t),this.y*(t.y||t))},H[t].sub=function(t){return this.add(t.mult(-1))},H[t][u]=function(t){return Math.sqrt(this.x*this.x+this.y*this.y)};var J={},O=G.Sound=function(t,n,e){"string"!=typeof n&&(n=t,e=n),this[x]=n,J[t]||O.load(t,n,e)};O.load=function(t,n,e){var i=J[t]=P[h]("audio");e&&(i.loop="loop");var o=P[h]("source");o.src=n,i.appendChild(o),i.load()},O.play=O[t].play=function(t){t=this[x]||t,J[t].play()},O[A]=O[t][A]=function(t){t=this[x]||t,J[t][A]()};var W=G.G={},X=new H(1),Y=new H,K=!1,N=!1,Q=!1,U=!1,V=!1,Z={},$={},tt={},nt={};P.onkeydown=function(t){Z[t.keyCode]=!0},P.onkeyup=function(t){Z[t.keyCode]=!1;var n="key_"+tt[t.keyCode];N&&N[n]&&N[n](tt[t.keyCode])},W[B]=function(t,n,i,s){K=!1,W[o]=n,W[e]=i,W.setCanvas(t),$=s||{},tt={};for(var r in s)tt[s[r]]=r;return this},W.keyDown=function(t){if("string"==typeof t)return Z[$[t]];for(var n=0;n<t[u];n++)if(W.keyDown(t[n]))return!0;return!1},W.on=function(t,n,e){if("key"===t){"object"!=typeof n&&(n=[n]);for(var i=0;i<n[u];i++){var o=n[i];N["key_"+o]=e}}else nt[t]&&P[C](t,nt[t]),P.addEventListener(t,nt[t]=n);return this};var et=function(){for(var t in nt)P[C](t,nt[t]);nt={}};W[r]=function(t){var n=Q.getBoundingClientRect(),i=t.clientX-n.left,s=t.clientY-n.top;return new H(Math.floor(i*W[o]/Q[o]),Math.floor(s*W[e]/Q[e]))},W.setCanvas=function(t){Q=t,U=t[k]("2d");var n=!1;return t.onmousedown=function(t){n=t,W[g]("dragstart",t)},t.onmouseup=function(t){var e=W[r](n),i=W[r](t);e.sub(i)[u]()<=2?W[g]("click",t):W[g]("dragend",t),n=!1},t.onmousemove=function(t){Y=W[r](t),n&&W[g]("drag",t)},W.resize(),this},W.resize=function(){var t=Q.parentElement,n=t[o]||t.clientWidth,i=t[e]||t.clientHeight;return Q[o]=n,Q[e]=n*W[e]/W[o],Q[e]>i&&(Q[e]=i,Q[o]=i*W[o]/W[e]),X=new H(Q[o]/W[o],Q[e]/W[e]),N&&(N.__hasRendered=!1),this},W.setState=function(t){return et(),N=t,N.game=W,N[B](),N.__hasRendered=!1,this},W[g]=function(t,n){N&&N[t]&&N[t](W[r](n))},W[c]=function(){if(K){j(W[c]);var t=(new Date).getTime(),n=(t-V)/1e3;if(n>.2)return void(V=t);try{var e=!N[c](n,W)||N[a];N[a]=!1,V=t,(e||!N.__hasRendered)&&(W[f](),N.__hasRendered=!0)}catch(i){console.error(i),W[A]()}}},W[f]=function(){return U.save(),U[_](X.x,X.y),N.stopClear||U.clearRect(0,0,W[o],W[e]),N[f](U),U.restore(),this},W.run=function(){return K=!0,V=(new Date).getTime(),W[c](),this},W[A]=function(){K=!1};var it=G.S=function(){};it[t][B]=it[t][c]=it[t][f]=function(){};var ot=0,st=G.E=function(t,i){"string"==typeof i&&(i=[i]),this[n]={},this[a]={},this.state=t,this[m]=[],i=i||this.__proto__[n],this[y]=new H,this[_]=new H(1),this[o]=this[e]=0;for(var s=0;s<i[u];s++)this[z](i[s]);this[B]&&this[B]()};st[t][n]=[],st[t][z]=function(t,n){if("function"==typeof t)t=new t(this);else if("string"==typeof t){if(!G.Cs[t])throw"Component "+t+" does not exist";t=new G.Cs[t](this)}t.__proto__[x]||(t.__proto__[x]="_component_"+ot.toString(),ot++);var n=n||t.__proto__[x];if(this.components[n])throw"Component "+n+" already exists";t.entity=this,this.components[n]=t},st[t].getComponent=function(t){return this.components[t]},st[t][c]=function(t,e){if(e&&!this.updated[e])return this.updated[e]=!0,this.components[e][c](t,this.state.game),this.components[e];this[a]={};for(var i in this[n])this.updated[i]||this[c](t,i)},st[t][f]=function(i){i.save();var s=this[y];i.translate(s.x,s.y),i[_](this[_].x,this[_].y);var r=Array[t].slice.call(arguments);1===r[u]&&(r[F](0),r[F](0),r[F](this[o]),r[F](this[e]));for(var a in this[n])this.components[a][f][E](this.components[a],r);if(this.children[u]>0)for(var h=0;h<this.children[u];h++)this.children[h][f](i);i.restore()},st[t].addChild=function(t){t[S]=this,this[m][F](t)},st[t][M]=function(){var t,n=this[y];return(t=this[S])?t[M]().add(this[y].mult(t[w]())):n},st[t][w]=function(){var t=this[_];return this[S]?this[_].mult(this.parent[w]()):t};var rt=G.C=function(){};rt[t][x]=0,rt[t][c]=rt[t][f]=function(){},G.Cs={},rt[q]=function(t,n,e){return n[x]=n[x]||t,G.Cs[t]=this[D](n,e)};var at=function(t){for(var n=1;n<arguments[u];n++){var e=arguments[n];for(var i in e)t[i]=e[i]}},ht=function(n,e){var i,o=this;i=n[d]!==n.__proto__[d]?n[d]:function(){return o[E](this,arguments)},at(i,o,e||{});var s=function(){this[d]=i};return s[t]=o[t],i[t]=new s,n&&at(i[t],n),i[t].__super__=o[t],i};it[D]=st[D]=rt[D]=ht,rt[q]("Image",{constructor:function(t){var n=this;this._tint=!1,this[I]=1,this[l]=new Image,this[l][L]=function(){t[o]||t[e]||(t[o]=this[o],t[e]=this[e]),n._tint&&n.setTint(n._tint),n[L]&&n[L](this),t.state[a]=!0},this[l].onerror=function(){n[l]=new Image},t.setImage=this.setImage.bind(this)},setTint:function(t){if(this._tint=t,this[l].complete){var n=this[p]=this[p]||P[h]("canvas");n[o]=this.image[o],n[e]=this.image[e];var r=n[k]("2d");r[i]=this._tint,r.fillRect(0,0,n[o],n[e]),r.globalCompositeOperation="destination-atop",r[s]=.75,r[v](this[l],0,0),r[s]=1}return this},setImage:function(t){return this[l].src=t,this},render:function(t){var n=t[s],e=arguments;t[s]=this[I],e[0]=this[l],t[v][E](t,e),this._tint&&(e[0]=this[p],t[v][E](t,e)),t[s]=n}}),rt[q]("Box",{constructor:function(){this[i]="white"},render:function(t,n,e,o,s){t[i]=this[i],t.fillRect(n,e,o,s)}}),rt[q]("Text",{constructor:function(){this[p]=P[h]("canvas"),this.context=this[p][k]("2d");var t=this[T]={};t[R]="32px Arial",t[T]="",t[i]="white",this[I]=1},set:function(t){var n=this[T],s=this.entity,r=this.context,a=this[p];n[R]=t[R]||n[R],n[T]=t[T]||n[T],n[i]=t[i]||n[i],r[R]=n[R],r[i]=n[i];var h=r.measureText(n[T]);s[o]=a[o]=Math.ceil(h[o]),s[e]=a[e]=Math.ceil(5*parseInt(n[R])/3),r.textBaseline="top",r[R]=n[R],r[i]=n[i],r.fillText(n[T],0,0)},render:function(t){var n=t[s];t[s]=this[I],arguments[0]=this[p],t[v][E](t,arguments),t[s]=n}})}(window,document)}("prototype","components","height","fillStyle","width","globalAlpha","getCanvasCoords","updated","createElement","length","update","render","constructor","image","children","canvas","drawImage","trigger","scale","position","globalScale","removeEventListener","name","getContext","font","keyCode","opacity","text","pause","apply","parent","globalPosition","create","extend","addComponent","init","push","onload",function(){},function(){return document.createElement("canvas")});