!function(t,n,i,e,s,o,r,a,h,u,c,f,d,l,m,p,v,y,_,g,x,w,C,b,k,R,T,I,S,q,A,E,M,z,D,L,B,F,j,G,P,V,H,J,O,U,W,X){"use strict";!function(S,W){var X=function(){return S.requestAnimationFrame||S.webkitRequestAnimationFrame||S.mozRequestAnimationFrame||function(t){S.setTimeout(t,1e3/60)}}(),Y=S._J={};Y[m]={};var $=Y.P=function(t,n){this.x=t=t||0,this.y=void 0!=n?n:t};$[F]=function(t,n){return new $(t,n)},$[t].clone=function(){return $[F](this.x,this.y)},$[t].equal=function(t,n){return"number"==typeof t?this.x===t&&this.y===n:this.x===t.x&&this.y===t.y},$[t][a]=function(t){return Math.sqrt(this.x*this.x+this.y*this.y)},$[t]._add=function(t,n){return this.x+=t.x||t,this.y+=t.y||n,this},$[t]._sub=function(t,n){return this.x-=t.x||t,this.y-=t.y||n,this},$[t]._mult=function(t,n){return this.x*=t.x||t,this.y+=t.y||n,this},$[t].add=function(t,n){return $[F](this.x,this.y)._add(t,n)},$[t].mult=function(t,n){return $[F](this.x,this.y)._mult(t,n)},$[t].sub=function(t,n){return $[F](this.x,this.y)._sub(t,n)},Y[m][_]=.4,Y[m][j]=["mp3","ogg"];var K=Y.Sound=function(t,n){"string"!=typeof t&&console.error("Source must be URL. Maybe you mean to create a SoundGroup?"),n=n||{};var i=this[x]=W[c]("audio"),e=t.match(/(.*)\.(aac|ogg|wav|mp3)$/),s=n[j]||Y[m][j];e&&(s=[e[2]],t=e[1]);for(var o=0;o<s[a];o++){var r=W[c]("source");r.src=t+"."+s[o],i.appendChild(r)}this.setVolume(n[_]||Y[m][_]);var h=void 0!=n[G]?n[G]:this[G];this[H](h)};K[t][_]=1,K[t][G]=!1,K[t].setVolume=function(t){this.sound[_]=this[_]=t},K[t][H]=function(t){this[G]=t,this[x][G]=t?"loop":""},K[t].play=function(){this[x].play()},K[t][M]=function(){this[x][M]()},K[t].stop=function(){this[x][M](),this[x].currentTime=0};var N=Y.G={},Q=$[F](1),Z=$[F](),tt=!1,nt=!1,it=!1,et=!1,st=!1,ot={},rt={},at={},ht={};W.onkeydown=function(t){ot[t.keyCode]=!0},W.onkeyup=function(t){ot[t.keyCode]=!1;var n="key_"+at[t.keyCode];nt&&nt[n]&&nt[n](at[t.keyCode])},N[J]=function(t,n,i,s){tt=!1,N[r]=n,N[e]=i,N.setCanvas(t),rt=s||{},at={};for(var o in s)at[s[o]]=o;return this},N.keyDown=function(t){if("string"==typeof t)return ot[rt[t]];for(var n=0;n<t[a];n++)if(N.keyDown(t[n]))return!0;return!1},N.on=function(t,n,i){if("key"===t){"object"!=typeof n&&(n=[n]);for(var e=0;e<n[a];e++){var s=n[e];nt["key_"+s]=i}}else ht[t]&&W[k](t,ht[t]),W.addEventListener(t,ht[t]=n);return this},N.off=function(t){"object"!=typeof t&&(t=[t]);for(var n=0;n<t[a];n++){var i=t[n];delete nt["key_"+i]}};var ut=function(){for(var t in ht)W[k](t,ht[t]);ht={}};N[o]=function(t){var n=it.getBoundingClientRect(),i=t.clientX-n.left,s=t.clientY-n.top;return $[F](Math.floor(i*N[r]/it[r]),Math.floor(s*N[e]/it[e]))},N.setCanvas=function(t){it=t,et=t[R]("2d");var n=!1;return t.onmousedown=function(t){n=t,N[g]("dragstart",t)},t.onmouseup=function(t){var i=N[o](n),e=N[o](t);i.sub(e)[a]()<=2?N[g]("click",t):N[g]("dragend",t),n=!1},t.onmousemove=function(t){Z=N[o](t),n&&N[g]("drag",t)},N.resize(),this},N.resize=function(){var t=it.parentElement,n=t[r]||t.clientWidth,i=t[e]||t.clientHeight;return it.attributes.fixed||(it[r]=n,it[e]=n*N[e]/N[r],it[e]>i&&(it[e]=i,it[r]=i*N[r]/N[e])),Q=new $(it[r]/N[r],it[e]/N[e]),nt&&(nt.__hasRendered=!1),this};var ct=!1;N.setState=function(t){return ct=t,this};var ft=function(){for(;ct;)ut(),nt&&nt.complete&&nt.cleanup(),nt=ct,ct=!1,nt.game=N,nt[J](),nt.__hasRendered=!1};N[g]=function(t,n){nt&&nt[t]&&nt[t](N[o](n))},N[h]=function(){if(tt){X(N[h]);var t=(new Date).getTime(),n=(t-st)/1e3;if(n>.05)return void(st=t);try{ft();var i=!nt[h](n,N)||nt[u];nt[u]=!1,st=t,(i||!nt.__hasRendered)&&(N[f](),nt.__hasRendered=!0),N.stats&&N.stats[h](n)}catch(e){console.error(e),N[M]()}}},N[f]=function(){return et.save(),et[w](Q.x,Q.y),nt.stopClear||et.clearRect(0,0,N[r],N[e]),nt[f](et),et.restore(),this},N.run=function(){return tt=!0,st=(new Date).getTime(),N[h](),this},N[M]=function(){tt=!1};var dt=Y.S=function(){};dt[t][J]=dt[t][h]=dt[t][f]=dt[t].cleanup=function(){};var lt=0,mt=Y.E=function(t,i){"string"==typeof i&&(i=[i]),this[n]={},this[u]={},this.state=t,this[p]=[],i=i||this.__proto__[n],this[C]=$[F](),this[O]=$[F](),this[A]=$[F](),this[w]=$[F](1),this.rotation=0;for(var e=0;e<i[a];e++)this[P](i[e]);this[J]&&this[J]()};mt[t][n]=[],mt[t][P]=function(t,n){if("function"==typeof t)t=new t(this);else if("string"==typeof t){if(!Y.Cs[t])throw"Component "+t+" does not exist";t=new Y.Cs[t](this)}t.__proto__[V]||(t.__proto__[V]="_component_"+lt.toString(),lt++);var n=n||t.__proto__[V];if(this.components[n])throw"Component "+n+" already exists";t.entity=this,this.components[n]=t},mt[t].getComponent=function(t){return this.components[t]},mt[t][h]=function(t,i){if(i){if(this.components[i]&&this.updated[i]!==t)return this.updated[i]=t,this.components[i][h](t,this.state.game),this.components[i]}else{this[u]={};for(var e in this[n])this.updated[e]!==t&&this[h](t,e)}},mt[t][f]=function(i){i.save();var s=this[C];i.translate(s.x+this[A].x*this[O].x,s.y+this[A].y*this[O].y),i[w](this[w].x,this[w].y),i.rotate(this.rotation);var o=Array[t].slice.call(arguments);o[1]=o[1]||0,o[2]=o[2]||0,o[3]=o[3]||this[r],o[4]=o[4]||this[e];for(var h in this[n])this.components[h][f][z](this.components[h],o);if(this.children[a]>0)for(var u=0;u<this.children[a];u++)this.children[u][f](i);i.restore()},mt[t].addChild=function(t){t[D]=this,this[p].push(t)},mt[t][L]=function(){var t;return(t=this[D])?t[L]()._add(this[C].mult(t[b]())):this[C].clone()},mt[t][b]=function(){return this[D]?this.parent[b]()._mult(this[w]):this[w].clone()};var pt=Y.C=function(){};pt[t][V]=0,pt[t][h]=pt[t][f]=function(){},Y.Cs={},pt[B]=function(t,n,i){return n[V]=n[V]||t,Y.Cs[t]=this[T](n,i)};var vt=function(t){for(var n=1;n<arguments[a];n++){var i=arguments[n];for(var e in i)t[e]=i[e]}},yt=Y[T]=function(n,i){var e,s=this;e=n[d]!==n.__proto__[d]?n[d]:function(){return s[z](this,arguments)},vt(e,s,i||{});var o=function(){this[d]=e};return o[t]=s[t],e[t]=new o,n&&vt(e[t],n),e[t].__super__=s[t],e};dt[T]=mt[T]=pt[T]=yt,pt[B]("Image",{constructor:function(t){var n=this;this._tint=!1,this[q]=1,this[l]=new Image,this[l][U]=function(){t[A].equal(0,0)&&(t[A].x=this[r],t[A].y=this[e]),n._tint&&n.setTint(n._tint),n[U]&&n[U](this),t.state[u]=!0},this[l].onerror=function(){n[l]=new Image},t.setImage=this.setImage.bind(this)},setTint:function(t){if(this._tint=t,this[l].complete){var n=this[v]=this[v]||W[c]("canvas");n[r]=this.image[r],n[e]=this.image[e];var o=n[R]("2d");o[i]=this._tint,o.fillRect(0,0,n[r],n[e]),o.globalCompositeOperation="destination-atop",o[s]=.75,o[y](this[l],0,0),o[s]=1}return this},setImage:function(t){return this[l].src=t,this},render:function(t){var n=t[s],i=arguments;t[s]=this[q],i[0]=this[l],t[y][z](t,i),this._tint&&(i[0]=this[v],t[y][z](t,i)),t[s]=n}}),pt[B]("Box",{constructor:function(){this[i]="white"},render:function(t,n,e,s,o){t[i]=this[i],t.fillRect(n,e,s,o)}}),pt[B]("Text",{constructor:function(){this[v]=W[c]("canvas"),this.context=this[v][R]("2d");var t=this[E]={};t[I]="32px Arial",t[E]="",t[i]="white",this[q]=1},set:function(t){var n=this[E],s=this.entity,o=this.context,a=this[v];n[I]=t[I]||n[I],n[E]=t[E]||n[E],n[i]=t[i]||n[i],o[I]=n[I],o[i]=n[i];var h=o.measureText(n[E]);s[A].x=a[r]=Math.ceil(h[r]),s[A].y=a[e]=Math.ceil(5*parseInt(n[I])/3),o.textBaseline="top",o[I]=n[I],o[i]=n[i],o.fillText(n[E],0,0)},render:function(t){var n=t[s];t[s]=this[q],arguments[0]=this[v],t[y][z](t,arguments),t[s]=n}})}(window,document)}("prototype","components","fillStyle","height","globalAlpha","getCanvasCoords","width","length","update","updated","createElement","render","constructor","image","defaults","children","canvas","drawImage","volume","trigger","sound","scale","position","globalScale","removeEventListener","getContext","extend","font","keyCode","opacity","size","text","pause","apply","parent","globalPosition","create","new","formats","loop","addComponent","name","setLooping","init","anchor","onload",function(){},function(){return document.createElement("canvas")});