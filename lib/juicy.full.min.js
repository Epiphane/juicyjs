!function(t,n,i,e,s,o,r,a,u,h,c,f,d,l,m,p,v,_,y,x,g,w,C,b,J,k,M,S,E,R,I,T,A,P,q,z,F,D,L,B,G,X,j,H,O,U,V,W,Y,$,K,N,Q,Z){"use strict";!function(T,A){var F=function(){return T.requestAnimationFrame||T.webkitRequestAnimationFrame||T.mozRequestAnimationFrame||function(t){T.setTimeout(t,1e3/60)}}(),Q=T._J={};Q[m]={};var Z=Q.P=function(t,n){this.x=t=t||0,this.y=void 0!=n?n:t};Z[X]=function(t,n){return new Z(t,n)},Z[t].clone=function(){return Z[X](this.x,this.y)},Z[t].equal=function(t,n){return"number"==typeof t?this.x===t&&this.y===n:this.x===t.x&&this.y===t.y},Z[t][h]=function(t){return Math.sqrt(this.x*this.x+this.y*this.y)},Z[t]._add=function(t,n){return this.x+=t.x||t,this.y+=t.y||n,this},Z[t]._sub=function(t,n){return this.x-=t.x||t,this.y-=t.y||n,this},Z[t]._mult=function(t,n){return this.x*=t.x||t,this.y+=t.y||n,this},Z[t].add=function(t,n){return Z[X](this.x,this.y)._add(t,n)},Z[t].mult=function(t,n){return Z[X](this.x,this.y)._mult(t,n)},Z[t].sub=function(t,n){return Z[X](this.x,this.y)._sub(t,n)},Q.defaults[a]=.4,Q[m][j]=["mp3","ogg"];var tt=Q[U]=function(t,n){"string"!=typeof t&&console.error("Source must be URL. Maybe you mean to create a SoundGroup?"),n=n||{};var i=this[g]=A[l]("audio"),e=t.match(/(.*)\.(aac|ogg|wav|mp3)$/),s=n[j]||Q[m][j];e&&(s=[e[2]],t=e[1]);for(var o=0;o<s[h];o++){var r=A[l]("source");r.src=t+"."+s[o],i.appendChild(r)}this[w](n[a]||Q.defaults[a]);var u=void 0!=n[E]?n[E]:this[E];this[Y](u)};tt[t][a]=1,tt[t][E]=!1,tt[t][w]=function(t){this.sound[a]=this[a]=t},tt[t][Y]=function(t){this[E]=t,this[g][E]=t?"loop":""},tt[t].play=function(){this[g].play()},tt[t][J]=function(){this[g][J]()},tt[t].stop=function(){this[g][J](),this[g][V]=0};var nt=Q.G={},it=Z[X](1),et=Z[X](),st=!1,ot=!1,rt=!1,at=!1,ut=!1,ht={},ct={},ft={},dt={};A.onkeydown=function(t){ht[t.keyCode]=!0},A.onkeyup=function(t){ht[t.keyCode]=!1;var n="key_"+ft[t.keyCode];ot&&ot[n]&&ot[n](ft[t.keyCode])},nt[$]=function(t,n,e,s){st=!1,nt[r]=n,nt[i]=e,nt.setCanvas(t),ct=s||{},ft={};for(var o in s)ft[s[o]]=o;return this},nt.keyDown=function(t){if("string"==typeof t)return ht[ct[t]];for(var n=0;n<t[h];n++)if(nt.keyDown(t[n]))return!0;return!1},nt.on=function(t,n,i){if("key"===t){"object"!=typeof n&&(n=[n]);for(var e=0;e<n[h];e++){var s=n[e];ot["key_"+s]=i}}else dt[t]&&A[S](t,dt[t]),A.addEventListener(t,dt[t]=n);return this},nt.off=function(t){"object"!=typeof t&&(t=[t]);for(var n=0;n<t[h];n++){var i=t[n];delete ot["key_"+i]}};var lt=function(){for(var t in dt)A[S](t,dt[t]);dt={}};nt[u]=function(t){var n=rt.getBoundingClientRect(),e=t.clientX-n.left,s=t.clientY-n.top;return Z[X](Math[W](e*nt[r]/rt[r]),Math[W](s*nt[i]/rt[i]))},nt.setCanvas=function(t){rt=t,at=t[R]("2d");var n=!1;return t.onmousedown=function(t){n=t,nt[b]("dragstart",t)},t.onmouseup=function(t){var i=nt[u](n),e=nt[u](t);i.sub(e)[h]()<=2?nt[b]("click",t):nt[b]("dragend",t),n=!1},t.onmousemove=function(t){et=nt[u](t),n&&nt[b]("drag",t)},nt.resize(),this},nt.resize=function(){var t=rt.parentElement,n=t[r]||t.clientWidth,e=t[i]||t.clientHeight;return rt.attributes.fixed||(rt[r]=n,rt[i]=n*nt[i]/nt[r],rt[i]>e&&(rt[i]=e,rt[r]=e*nt[r]/nt[i])),it=new Z(rt[r]/nt[r],rt[i]/nt[i]),ot&&(ot.__hasRendered=!1),this};var mt=!1;nt.setState=function(t){return mt=t,this};var pt=function(){for(;mt;)lt(),ot&&ot.complete&&ot.cleanup(),ot=mt,mt=!1,ot.game=nt,ot[$](),ot.__hasRendered=!1};nt[b]=function(t,n){ot&&ot[t]&&ot[t](nt[u](n))},nt[f]=function(){if(st){F(nt[f]);var t=(new Date).getTime(),n=(t-ut)/1e3;if(n>.05)return void(ut=t);try{pt();var i=!ot[f](n,nt)||ot[d];ot[d]=!1,ut=t,(i||!ot.__hasRendered)&&(nt[p](),ot.__hasRendered=!0),nt.stats&&nt.stats[f](n)}catch(e){console.error(e),nt[J]()}}},nt[p]=function(){return at.save(),at[k](it.x,it.y),ot.stopClear||at.clearRect(0,0,nt[r],nt[i]),ot[p](at),at.restore(),this},nt.run=function(){return st=!0,ut=(new Date).getTime(),nt[f](),this},nt[J]=function(){st=!1};var vt=Q.S=function(){};vt[t][$]=vt[t][f]=vt[t][p]=vt[t].cleanup=function(){};var _t=0,yt=Q.E=function(t,i){"string"==typeof i&&(i=[i]),this[n]={},this[d]={},this.state=t,this[y]=[],i=i||this.__proto__[n],this[s]=Z[X](),this[K]=Z[X](),this[q]=Z[X](),this[k]=Z[X](1),this.rotation=0;for(var e=0;e<i[h];e++)this[H](i[e]);this[$]&&this[$]()};yt[t][n]=[],yt[t][H]=function(t,n){if("function"==typeof t)t=new t(this);else if("string"==typeof t){if(!Q.Cs[t])throw"Component "+t+" does not exist";t=new Q.Cs[t](this)}t.__proto__[O]||(t.__proto__[O]="_component_"+_t.toString(),_t++);var n=n||t.__proto__[O];if(this.components[n])throw"Component "+n+" already exists";t.entity=this,this.components[n]=t},yt[t].getComponent=function(t){return this.components[t]},yt[t][f]=function(t,i){if(i){if(this.components[i]&&this.updated[i]!==t)return this.updated[i]=t,this.components[i][f](t,this.state.game),this.components[i]}else{this[d]={};for(var e in this[n])this.updated[e]!==t&&this[f](t,e)}},yt[t][p]=function(e){e.save();var o=this[s];e.translate(o.x+this[q].x*this[K].x,o.y+this[q].y*this[K].y),e[k](this[k].x,this[k].y),e.rotate(this.rotation);var a=Array[t].slice.call(arguments);a[1]=a[1]||0,a[2]=a[2]||0,a[3]=a[3]||this[r],a[4]=a[4]||this[i];for(var u in this[n])this.components[u][p][D](this.components[u],a);if(this.children[h]>0)for(var c=0;c<this.children[h];c++)this.children[c][p](e);e.restore()},yt[t].addChild=function(t){t[L]=this,this[y].push(t)},yt[t][B]=function(){var t;return(t=this[L])?t[B]()._add(this[s].mult(t[M]())):this[s].clone()},yt[t][M]=function(){return this[L]?this.parent[M]()._mult(this[k]):this[k].clone()};var xt=Q.C=function(){};xt[t][O]=0,xt[t][f]=xt[t][p]=function(){},Q.Cs={},xt[G]=function(t,n,i){return n[O]=n[O]||t,Q.Cs[t]=this[c](n,i)};var gt=function(t){for(var n=1;n<arguments[h];n++){var i=arguments[n];for(var e in i)t[e]=i[e]}},wt=Q[c]=function(n,i){var e,s=this;e=n[v]!==n.__proto__[v]?n[v]:function(){return s[D](this,arguments)},gt(e,s,i||{});var o=function(){this[v]=e};return o[t]=s[t],e[t]=new o,n&&gt(e[t],n),e[t].__super__=s[t],e};vt[c]=yt[c]=xt[c]=wt,xt[G]("Image",{constructor:function(t){var n=this;this._tint=!1,this[P]=1,this[_]=new Image,this[_][N]=function(){t[q].equal(0,0)&&(t[q].x=this[r],t[q].y=this[i]),n._tint&&n.setTint(n._tint),n[N]&&n[N](this),t.state[d]=!0},this[_].onerror=function(){n[_]=new Image},t.setImage=this.setImage.bind(this)},setTint:function(t){if(this._tint=t,this[_].complete){var n=this[x]=this[x]||A[l]("canvas");n[r]=this.image[r],n[i]=this.image[i];var s=n[R]("2d");s[e]=this._tint,s.fillRect(0,0,n[r],n[i]),s.globalCompositeOperation="destination-atop",s[o]=.75,s[C](this[_],0,0),s[o]=1}return this},setImage:function(t){return this[_].src=t,this},render:function(t){var n=t[o],i=arguments;t[o]=this[P],i[0]=this[_],t[C][D](t,i),this._tint&&(i[0]=this[x],t[C][D](t,i)),t[o]=n}}),xt[G]("Box",{constructor:function(){this[e]="white"},render:function(t,n,i,s,o){t[e]=this[e],t.fillRect(n,i,s,o)}}),xt[G]("Text",{constructor:function(){this[x]=A[l]("canvas"),this.context=this[x][R]("2d");var t=this[z]={};t[I]="32px Arial",t[z]="",t[e]="white",this[P]=1},set:function(t){var n=this[z],s=this.entity,o=this.context,a=this[x];n[I]=t[I]||n[I],n[z]=t[z]||n[z],n[e]=t[e]||n[e],o[I]=n[I],o[e]=n[e];var u=o.measureText(n[z]);s[q].x=a[r]=Math.ceil(u[r]),s[q].y=a[i]=Math.ceil(5*parseInt(n[I])/3),o.textBaseline="top",o[I]=n[I],o[e]=n[e],o.fillText(n[z],0,0)},render:function(t){var n=t[o];t[o]=this[P],arguments[0]=this[x],t[C][D](t,arguments),t[o]=n}})}(window,document),function(n,i){var e=_J[U];e[t].mix=1,e[t][w]=function(t){this[a]=t,this[F]()},e[t][F]=function(){this.sound[a]=this[a]*this.mix};var s=_J.SoundGroup=function(t){t=t||{},this[T]={},this[a]=t[a]||_J.defaults[a],void 0!=t[E]&&(this[E]=!!t[E])};s[t][U]=e,s[t].load=function(t,n,i){var e=new this[U](n,i);i&&void 0!=i.mix&&(e.mix=i.mix,e[F]()),this.sounds[t]=e},s[t].forEach=function(t){for(var n in this[T])t.call(this,this.sounds[n])},s[t][w]=function(t){this.forEach(function(t){t[a]=t.mix*this[a]})},s[t]["do"]=function(t,n){var i=this.sounds[t];if(i)return i[n](),i;throw"Attempted to call "+n+" on nonexistent sound "+t},s[t].play=function(t){this["do"](t,"play")},s[t][J]=function(t){this["do"](t,"pause")},s[t][J]=function(t){var n=this["do"](t,"pause");n[V]=0},s[c]=e[c]=_J[c],_J.Music=e[c]({loop:!0}),_J.SFX=e[c]({play:function(){this.stop(),e[t].play.call(this)}}),_J.Musics=s[c]({Sound:_J.Music}),_J.SoundEffects=s[c]({Sound:_J.SFX})}(window._J,_J.E),function(n,e){_J.rand=function(t,n){return n?Math[W](Math.random()*(n-t))+t:Math[W](Math.random()*t)},_J.PI=Math.PI,_J.P[t].normalize=function(t){return t=t||1,this.mult(t/this[h]())},e[t].contains=function(t){return t=t.sub(this[s]),t.x>=0&&t.y>=0&&t.x<=this[r]&&t.y<=this[i]},e[t].distance=function(t){return t.x||(t=t[s]),this[s].sub(t)[h]()},e[t].testCollision=function(t){var n=t[s].add(new Point(t[r],t[i])),e=this[s].add(new Point(this[r],this[i]));return n.x>=this[s].x&&n.y>=this[s].y&&t[s].x<=e.x&&t[s].y<=e.y}}(window._J,_J.E)}("prototype","components","height","fillStyle","position","globalAlpha","width","volume","getCanvasCoords","length","extend","update","updated","createElement","defaults","render","constructor","image","children","canvas","sound","setVolume","drawImage","trigger","pause","scale","globalScale","removeEventListener","loop","getContext","font","sounds","keyCode","opacity","size","text","udpateMix","apply","parent","globalPosition","create","new","formats","addComponent","name","Sound","currentTime","floor","setLooping","init","anchor","onload",function(){},function(){return document.createElement("canvas")});